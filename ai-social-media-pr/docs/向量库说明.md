# 向量库说明

## 是否已经完成向量化？

- **逻辑上**：已实现。代码会从 `samples/nice/` 的截图中用 Vision 识别正例格子，再用 **CLIP** 对正例封面做 **embedding**，写入「向量库」文件。
- **实际上**：向量库文件需要**你本地跑一次脚本**才会生成。你放入 nice 截图后执行 `python scripts/build_ref_from_samples.py`，才会得到 `ref_embeddings.json`。

## 向量库文件在哪里？

生成后的「向量数据库」就是一个 **JSON 文件**，路径为：

```
profiles/douyin_mom_finder/ref_embeddings.json
```

- 若用默认 profile（douyin_mom_finder），脚本会把向量库写到这里。
- 若指定其他 profile（`build_ref_from_samples.py -p <name>`），则路径为 `profiles/<name>/ref_embeddings.json`。

## 文件内容是什么？

打开 `ref_embeddings.json` 可以看到一个数组，每项大致为：

```json
{
  "id": "ref_0",
  "cover_path": "/path/to/cell_02.jpg",
  "embedding": [0.012, -0.034, ...],
  "label_type": "宝妈",
  "label_tone": "真实生活感",
  "weight": "high",
  "source": "某张截图.png",
  "cell_index": 2
}
```

- **embedding**：长度为 512 的浮点数组（CLIP ViT-B/32 的向量维度），即该正例封面的向量表示。
- 其他字段用于标注和筛选（类型、调性、权重、来源等）。

## 如何生成？

1. 把完全符合标准的截图放到 **samples/nice/**。
2. 安装依赖（含 `sentence-transformers`）：  
   `pip install -r requirements.txt`  
   （若用可选向量，需安装 sentence-transformers）
3. 在项目根目录执行：  
   `python scripts/build_ref_from_samples.py`  
   会遍历 nice 下所有截图 → 切格 → Vision 识别正例格 → 对正例封面算 embedding → 写入 `profiles/douyin_mom_finder/ref_embeddings.json`。

生成后，`judge.py` 在默认 profile 下会自动读取该文件（若存在），并用新截图的 24 格封面向量与库中向量做相似度比对，用于加分。
